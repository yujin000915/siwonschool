<!DOCTYPE html>

<html lang="ko">
	<head>
		<!-- meta -->
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- css -->
		<link rel="stylesheet"  href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />
		<link rel="stylesheet" href="./common/style.css">

		<!-- script -->
		<script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>

		<!-- title -->
		<title>인터렉티브 웹</title>
	</head>

	<style>
		html {
			height: 100vh;
		}

		body {
			height: 500vh;
		}

		canvas {
			position: fixed;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
			max-width: 100vw;
			max-height: 100vh;
		}

		img {
			width: 100%;
		}
	</style>

	<body>
		<canvas id="hero-lightpass">
	</body>
</html>

<script>
	const html = document.documentElement;
	const canvas = document.getElementById("hero-lightpass");
	const context = canvas.getContext("2d");

	const frameCount = 16;
	const currentFrame = index => ( `./image/dummy/img_${index}.jpg` )

	const preloadImages = () => {
		for (let i = 1; i < frameCount; i++) {
			const img = new Image();
			img.src = currentFrame(i);

			return false;
		}
	};

	const img = new Image()
		img.src = currentFrame(1);
		canvas.width = 1920;
		canvas.height = 1100;
		img.onload=function(){
		context.drawImage(img, 0, 0);
	}

	const updateImage = index => {
		img.src = currentFrame(index);
		context.drawImage(img, 0, 0);
	}

	window.addEventListener('scroll', () => {
		const scrollTop = html.scrollTop;
		const maxScrollTop = html.scrollHeight - window.innerHeight;
		const scrollFraction = scrollTop / maxScrollTop;
		const frameIndex = Math.min(
			frameCount - 1,
			Math.ceil(scrollFraction * frameCount)
		);

		requestAnimationFrame(() => updateImage(frameIndex + 1));
	});

	preloadImages();
</script>
